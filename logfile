#################
# chose dataset 
#################
# GSE 213994 from GEO
# PMID 37395319 (Okur et al. Aging cell 22: e13909 (2023)
# Paired end, 24.4 Gb
# 2 groups with 5 replicates each
# dataset added to spreadsheet, approved by teacher

# create folders on server : 
	# origScripts (unmodified scripts copied from data/scripts)
	# myScripts (edited)
	# testdir (to try out)
	# assigBIT09 (final versions)

###################
# download files
###################	

# test script for download

# 1) try fastq-dump for 1 sample into testdir
# not via script - only fastq-dump command on 1 sample, with 2 reads persample
# must use --gzip option and --split-3 because PE

fastq-dump --gzip --split-3 -X 2 -O testdir/ SRR21679459

# SRR21679459_2.fastq.gz file written to testdir

# 2) run script on all samples (but only 2 reads/sample)
# copy Accession list (with acc nrs) from NBCI GEO to testdir
# edit script for downloading to download only 2 runs per sample
fastq-dump --gzip -X 2
 
# in folder myScripts, adding SRR_Acc_list.txt to folder and output dit testdir
./bit09-download.sh SRR_Acc_list testdir PE

# --> all fastq.gz files generated (split into _1 and _2
# with 2 runs/sample

### bulk download
# run download of all samples in assigBIT09 folder
# output folder downloads
# remove -X 2 argument in bash script --> all reads get downloaded
# in tmux session download
./bit09-download-srr.sh SRR_Acc_List.txt downloads PE
# detach tmux session

# --> all downloads fastq.gz in folder downloads in assigBIT09


##########################
# fastqc preprocessing
##########################
# copy original bashscript bit09-fastqc.sh to myScripts

# bashscript requires 3 input parameters:
 1) path of folder with fastq.gz files (here: /home/erikf/assigBIT09/downloads)
 2) path of output folder (here : /home/erikf/assigBIT09/fastqc_output)
 3) number of threads

# testrun on 2 first samples (SRR21679459_1 and _2.fastq.gz) 
# put 2 fastq.gz files into folder testSubset, ans output into testOutput
./bit09-fastqc.sh /home/erikf/assigBIT09/testSubset/ /home/erikf/assigBIT09/testOutput/ 2

# transfer 2 .html files from /testOutput to local VM (folder assignment)
# html looks OK
 
# run entire QC on server in 8 threads (since low activity on server)
tmux attach -t download
./bit09-fastqc.sh /home/erikf/assigBIT09/downloads/ /home/erikf/assigBIT09/fastqc_output/ 8

# transfer all fastqc output files to local VM
# FTP via filezilla all .html to folder /BIT09/assignment/fastqc_results on VM

# run MultiQC on local VM in folder fastqc_results
# results in folder multiqc_data
# open file multiqc_report.html in firefox


########################## 
# Trimming
#######################
# search for overrepresented sequences using bit09-getAdapters.sh
# no overrept seqs found

# bash script for Trimmomatic requires inpur
 1) path of folder with input (test : testSubset)
 2) path of output folder (test : testOutputTrimm)
 3) adapter file (here: adapter.fa)
 4) number of threads
--> need to use PE file

# copy all adapters from optfolder into assigBIT09 on server
# combine all adapters into 1 file adapters.fa
cp /opt/Trimmomatic-0.39/adapters/* .
cat NexteraPE-PE.fa TruS* > adapters.fa
rm TruS*
rm Nex*

# folder for outpu from Trimmmomatic
mkdir testOutputTrimm

# 8 threads = too much
./bit09-trimmomatic-PE.sh /home/erikf/assigBIT09/downloads /home/erikf/outputTrimm/  /home/erikf/assigBIT09/adapters.fa 6





